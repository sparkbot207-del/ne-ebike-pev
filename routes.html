<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Routes & Trails - New England E-Bike and PEV</title>
    <meta name="description" content="Best e-bike friendly trails and routes across New England. Interactive map of rail trails in Vermont, Maine, New Hampshire, Massachusetts, Connecticut, and Rhode Island.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* Routes page specific styles */
        #trail-map {
            height: 500px;
            width: 100%;
            border-radius: 12px;
            margin: 2rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .map-section {
            padding: 2rem 0;
        }
        
        .map-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .legend-dot.vt { background: #2ecc71; }
        .legend-dot.me { background: #e74c3c; }
        .legend-dot.nh { background: #9b59b6; }
        .legend-dot.ma { background: #3498db; }
        .legend-dot.ct { background: #f39c12; }
        .legend-dot.ri { background: #1abc9c; }
        
        /* Map Controls */
        .map-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            margin-bottom: 1rem;
        }
        
        .map-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            color: rgba(255,255,255,0.8);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .map-toggle:hover {
            background: rgba(255,255,255,0.15);
        }
        
        .map-toggle.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        
        .map-toggle input {
            display: none;
        }
        
        .charging-count {
            font-size: 0.75rem;
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        /* Enhanced Popup Styles */
        .leaflet-popup-content {
            min-width: 200px;
        }
        
        .popup-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
            flex-wrap: wrap;
        }
        
        .popup-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            text-decoration: none;
            transition: all 0.2s;
        }
        
        .popup-btn-nav {
            background: #4285f4;
            color: white;
        }
        
        .popup-btn-nav:hover {
            background: #3367d6;
        }
        
        .popup-btn-web {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        
        .popup-btn-web:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .popup-btn-gpx {
            background: #10b981;
            color: white;
        }
        
        .popup-btn-gpx:hover {
            background: #059669;
        }
        
        /* Charging station popup */
        .charging-popup h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }
        
        .charging-popup .charging-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        .charging-popup .charging-type.j1772 {
            background: #f59e0b;
            color: #000;
        }
        
        .charging-popup .charging-type.nema {
            background: #10b981;
            color: white;
        }
        
        .charging-popup .charging-info {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.8);
            margin: 0.25rem 0;
        }
        
        /* Loading indicator */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 12px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .trails-section {
            padding: 3rem 0;
        }
        
        .state-group {
            margin-bottom: 3rem;
        }
        
        .state-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--accent);
        }
        
        .trail-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }
        
        .trail-card {
            background: var(--card-bg, #1a1a2e);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .trail-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }
        
        .trail-card.top-pick {
            border-color: var(--accent);
            position: relative;
        }
        
        .trail-card.top-pick::before {
            content: "â­ TOP PICK";
            position: absolute;
            top: -10px;
            right: 20px;
            background: var(--accent);
            color: #000;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
        }
        
        .trail-card h3 {
            color: #fff;
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
        }
        
        .trail-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
        }
        
        .trail-meta span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .trail-card p {
            color: rgba(255,255,255,0.8);
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }
        
        .trail-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .trail-tag {
            background: rgba(255,255,255,0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.8);
        }
        
        .resources-section {
            padding: 3rem 0;
            background: rgba(255,255,255,0.02);
        }
        
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .resource-link {
            display: block;
            background: var(--card-bg, #1a1a2e);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
            text-decoration: none;
            transition: all 0.2s;
        }
        
        .resource-link:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }
        
        .resource-link h3 {
            color: var(--accent);
            margin-bottom: 0.5rem;
        }
        
        .resource-link p {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }
        
        /* Leaflet popup styling */
        .leaflet-popup-content-wrapper {
            background: #1a1a2e;
            color: #fff;
            border-radius: 8px;
        }
        
        .leaflet-popup-tip {
            background: #1a1a2e;
        }
        
        .leaflet-popup-content h3 {
            margin: 0 0 0.5rem 0;
            color: #fff;
        }
        
        .leaflet-popup-content p {
            margin: 0.25rem 0;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.8);
        }
        
        .popup-distance {
            color: var(--accent) !important;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            #trail-map {
                height: 350px;
            }
            
            .trail-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav scrolled">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">âš¡ New England E-Bike and PEV</a>
            <div class="nav-links">
                <a href="index.html#community">Community</a>
                <a href="laws.html">Laws</a>
                <a href="routes.html" class="active">Routes</a>
                <a href="index.html#resources">Resources</a>
                <a href="https://www.facebook.com/groups/573295111141320/" target="_blank" class="nav-cta">Join Us</a>
            </div>
            <button class="nav-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Header -->
    <header class="page-header">
        <div class="container">
            <h1>ğŸ—ºï¸ Routes & Trails</h1>
            <p>Explore the best e-bike friendly trails across New England</p>
        </div>
    </header>

    <!-- Interactive Map Section -->
    <section class="map-section">
        <div class="container">
            <h2 class="section-title">Interactive Trail Map</h2>
            <p style="text-align: center; color: rgba(255,255,255,0.7); margin-bottom: 1rem;">Click markers for trail details â€¢ Toggle charging stations below</p>
            
            <!-- Map Layer Controls -->
            <div class="map-controls">
                <label class="map-toggle active">
                    <input type="checkbox" id="toggle-trails" checked>
                    ğŸš´ Trails
                </label>
                <label class="map-toggle" id="charging-toggle">
                    <input type="checkbox" id="toggle-charging">
                    âš¡ Charging Stations <span class="charging-count" id="charging-count">0</span>
                </label>
                <label class="map-toggle" id="j1772-toggle" style="display:none;">
                    <input type="checkbox" id="toggle-j1772" checked>
                    ğŸ”Œ J1772
                </label>
                <label class="map-toggle" id="nema-toggle" style="display:none;">
                    <input type="checkbox" id="toggle-nema" checked>
                    ğŸ”‹ NEMA
                </label>
            </div>
            
            <div id="trail-map" style="position: relative;">
                <div class="loading-overlay" id="map-loading" style="display: none;">
                    <div class="loading-spinner"></div>
                </div>
            </div>
            <div class="map-legend">
                <div class="legend-item"><span class="legend-dot ct"></span> Connecticut</div>
                <div class="legend-item"><span class="legend-dot me"></span> Maine</div>
                <div class="legend-item"><span class="legend-dot ma"></span> Massachusetts</div>
                <div class="legend-item"><span class="legend-dot nh"></span> New Hampshire</div>
                <div class="legend-item"><span class="legend-dot ri"></span> Rhode Island</div>
                <div class="legend-item"><span class="legend-dot vt"></span> Vermont</div>
            </div>
        </div>
    </section>

    <!-- Trails by State -->
    <section class="trails-section">
        <div class="container">
            
            <div class="state-group" id="connecticut">
                <h2 class="state-title">ğŸ›ï¸ Connecticut</h2>
                <div class="trail-cards">
                    <div class="trail-card top-pick">
                        <h3>Air Line State Park Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Portland â†’ Thompson</span>
                            <span>ğŸ“ 50 miles</span>
                        </div>
                        <p>Historic "Ghost Train" route! Flat gravel trail over viaducts and bridges, through wetlands, farmlands, and forest preserves. Yankee Editors' Pick for "Best Rail Trail."</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ† Award Winner</span>
                            <span class="trail-tag">ğŸŒ‰ Viaducts</span>
                            <span class="trail-tag">ğŸ“œ Historic</span>
                        </div>
                    </div>
                    <div class="trail-card">
                        <h3>Farmington Canal Heritage Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ New Haven â†’ Northampton MA</span>
                            <span>ğŸ“ 80+ miles total</span>
                        </div>
                        <p>Popular paved path following a historic canal route. Eventually will connect to Massachusetts trails.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ›¤ï¸ Paved</span>
                            <span class="trail-tag">ğŸ“œ Canal History</span>
                        </div>
                    </div>
                </div>

            <div class="state-group" id="maine">
                <h2 class="state-title">ğŸ¦ Maine</h2>
                <div class="trail-cards">
                    <div class="trail-card top-pick">
                        <h3>Eastern Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ South Portland â†’ Kennebunk</span>
                            <span>ğŸ“ 22 miles (65 total)</span>
                        </div>
                        <p>Flat, easy ride on asphalt and crushed stone. Features blueberry barrens, Rachel Carson Wildlife Refuge, Scarborough Marsh, and Bug Light Park.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ›¤ï¸ Paved</span>
                            <span class="trail-tag">ğŸ« Blueberries</span>
                            <span class="trail-tag">ğŸ¦… Wildlife Refuge</span>
                        </div>
                    </div>
                    <div class="trail-card">
                        <h3>Kennebec River Rail Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Augusta â†’ Gardiner</span>
                            <span>ğŸ“ 6.5 miles</span>
                        </div>
                        <p>Fully paved, flat riverside ride with four convenient access points. Great for beginners or casual rides.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ›¤ï¸ Fully Paved</span>
                            <span class="trail-tag">ğŸŒŠ Riverside</span>
                            <span class="trail-tag">ğŸ‘¶ Beginner Friendly</span>
                        </div>
                    </div>
                    <div class="trail-card">
                        <h3>Eastern Promenade Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Portland</span>
                            <span>ğŸ“ 2+ miles</span>
                        </div>
                        <p>Urban trail with stunning ocean views. Connects to Back Cove Trail for extended riding. Perfect for city exploration.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ™ï¸ Urban</span>
                            <span class="trail-tag">ğŸŒŠ Ocean Views</span>
                            <span class="trail-tag">ğŸ”— Connects Trails</span>
                        </div>
                    </div>
                </div>

            <div class="state-group" id="massachusetts">
                <h2 class="state-title">ğŸ–ï¸ Massachusetts</h2>
                <div class="trail-cards">
                    <div class="trail-card top-pick">
                        <h3>Cape Cod Rail Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ South Dennis â†’ South Wellfleet</span>
                            <span>ğŸ“ 22 miles</span>
                        </div>
                        <p>Paved path with gentle hills and beach access to Cape Cod National Seashore. Bike rentals available along the trail. Pet friendly!</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ›¤ï¸ Paved</span>
                            <span class="trail-tag">ğŸ–ï¸ Beach Access</span>
                            <span class="trail-tag">ğŸ• Pet Friendly</span>
                            <span class="trail-tag">ğŸš² Rentals</span>
                        </div>
                    </div>
                    <div class="trail-card">
                        <h3>Shining Sea Bikeway</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Falmouth</span>
                            <span>ğŸ“ 11 miles</span>
                        </div>
                        <p>Beautiful coastal ride through Falmouth with Buzzards Bay views. One of the Cape's most scenic paths.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸŒŠ Coastal</span>
                            <span class="trail-tag">ğŸ“¸ Scenic</span>
                        </div>
                    </div>
                    <div class="trail-card">
                        <h3>Ashuwillticook Rail Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Cheshire â†’ Adams</span>
                            <span>ğŸ“ 12.7 miles</span>
                        </div>
                        <p>Berkshires ride with Mount Greylock and Hoosic Mountains views. Parking lots and restrooms available along the route.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ”ï¸ Mountain Views</span>
                            <span class="trail-tag">ğŸ…¿ï¸ Parking</span>
                            <span class="trail-tag">ğŸš» Restrooms</span>
                        </div>
                    </div>
                    <div class="trail-card">
                        <h3>Nashua River Rail Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Ayer â†’ Nashua NH</span>
                            <span>ğŸ“ 12.5 miles</span>
                        </div>
                        <p>Cross-border trail connecting Massachusetts and New Hampshire. Great for longer rides.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ›¤ï¸ Paved</span>
                            <span class="trail-tag">ğŸ—ºï¸ Cross-State</span>
                        </div>
                    </div>
                </div>

            <div class="state-group" id="new-hampshire">
                <h2 class="state-title">â›°ï¸ New Hampshire</h2>
                <div class="trail-cards">
                    <div class="trail-card top-pick">
                        <h3>Northern Rail Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Lebanon â†’ Boscawen</span>
                            <span>ğŸ“ 59.3 miles</span>
                        </div>
                        <p>The longest rail trail in New Hampshire! Named to "100 Top Trails in U.S." Passes farms, orchards, lakes, and covered bridges with possible moose sightings.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ† Top 100 US Trail</span>
                            <span class="trail-tag">ğŸ¦Œ Wildlife</span>
                            <span class="trail-tag">ğŸŒ‰ Covered Bridges</span>
                        </div>
                    </div>
                    <div class="trail-card">
                        <h3>Presidential Rail Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Gorham â†’ Whitefield</span>
                            <span>ğŸ“ 18 miles</span>
                        </div>
                        <p>Breathtaking White Mountains Presidential Range views. Features beaver ponds, pastures, and key birding spots.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ”ï¸ Mountain Views</span>
                            <span class="trail-tag">ğŸ¦« Beaver Ponds</span>
                            <span class="trail-tag">ğŸ¦ Birding</span>
                        </div>
                    </div>
                    <div class="trail-card">
                        <h3>Cotton Valley Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Lakes Region</span>
                            <span>ğŸ“ 12 miles each way</span>
                        </div>
                        <p>5-star rated trail through New Hampshire's beautiful Lakes Region. Great for out-and-back rides.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">â­ 5-Star Rated</span>
                            <span class="trail-tag">ğŸ–ï¸ Lakes Region</span>
                        </div>
                    </div>
                </div>

            <div class="state-group" id="rhode-island">
                <h2 class="state-title">ğŸš Rhode Island</h2>
                <div class="trail-cards">
                    <div class="trail-card top-pick">
                        <h3>East Bay Bike Path</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Providence â†’ Bristol</span>
                            <span>ğŸ“ 14.5 miles</span>
                        </div>
                        <p>Rhode Island's most popular paved trail with beautiful Narragansett Bay views. Perfect for a day trip from Providence.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ›¤ï¸ Paved</span>
                            <span class="trail-tag">ğŸŒŠ Bay Views</span>
                            <span class="trail-tag">â­ Most Popular</span>
                        </div>
                    </div>
                    <div class="trail-card">
                        <h3>Blackstone River Bikeway</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Providence area</span>
                            <span>ğŸ“ 18+ miles</span>
                        </div>
                        <p>Follows the historic Blackstone River through industrial heritage sites. Still expanding!</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ“œ Historic</span>
                            <span class="trail-tag">ğŸŒŠ Riverside</span>
                        </div>
                    </div>
                </div>

            <div class="state-group" id="vermont">
                <h2 class="state-title">ğŸ”ï¸ Vermont</h2>
                <div class="trail-cards">
                    <div class="trail-card top-pick">
                        <h3>Island Line Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Burlington â†’ South Hero</span>
                            <span>ğŸ“ 14 miles</span>
                        </div>
                        <p>Stunning Lake Champlain views with a unique 3-mile causeway extending over the water. Paved and packed gravel surface with Adirondack mountain vistas.</p>
                        <p>âš ï¸ Note: 200ft gap requires seasonal ferry in summer months.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ›¤ï¸ Paved + Gravel</span>
                            <span class="trail-tag">ğŸŒ… Lake Views</span>
                            <span class="trail-tag">ğŸ“¸ Scenic</span>
                        </div>
                    </div>
                    <div class="trail-card">
                        <h3>Montpelier & Wells River Rail Trail</h3>
                        <div class="trail-meta">
                            <span>ğŸ“ Groton â†’ Marshfield</span>
                            <span>ğŸ“ 19 miles</span>
                        </div>
                        <p>Scenic dirt and cinder trail through untamed Vermont landscape. Lake Groton offers a refreshing swimming spot halfway through.</p>
                        <div class="trail-tags">
                            <span class="trail-tag">ğŸ›¤ï¸ Dirt/Cinder</span>
                            <span class="trail-tag">ğŸŠ Swimming</span>
                            <span class="trail-tag">ğŸŒ² Forest</span>
                        </div>
                    </div>
                </div>

        </div>
    </section>

    <!-- Resources Section -->
    <section class="resources-section">
        <div class="container">
            <h2 class="section-title">Trail Resources</h2>
            <div class="resources-grid">
                <a href="https://bikenewengland.com/" target="_blank" class="resource-link">
                    <h3>ğŸš´ Bike New England</h3>
                    <p>1000+ routes with GPX files, cue sheets, and maps for all New England states.</p>
                </a>
                <a href="https://www.trailspotting.com/p/trailspotting-rail-trails.html" target="_blank" class="resource-link">
                    <h3>ğŸ—ºï¸ Trailspotting</h3>
                    <p>Complete rail trail maps with surface conditions and points of interest.</p>
                </a>
                <a href="https://www.railstotrails.org/" target="_blank" class="resource-link">
                    <h3>ğŸ›¤ï¸ Rails-to-Trails Conservancy</h3>
                    <p>Official trail information and advocacy for rail trail conversion.</p>
                </a>
                <a href="https://www.greenway.org/" target="_blank" class="resource-link">
                    <h3>ğŸŒ¿ East Coast Greenway</h3>
                    <p>3,000-mile trail from Maine to Florida. Many NE trails are part of this network.</p>
                </a>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="section cta-section">
        <div class="container">
            <h2>Share Your Favorite Routes!</h2>
            <p>Know a great trail we missed? Join our community and share your discoveries with fellow riders.</p>
            <a href="https://www.facebook.com/groups/573295111141320/" target="_blank" class="btn btn-primary btn-large">Join Our Facebook Group</a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <span class="footer-logo">âš¡ NE E-Bike and PEV</span>
                    <p>A community for electric mobility enthusiasts in New England</p>
                </div>
                <div class="footer-links">
                    <a href="https://www.facebook.com/groups/573295111141320/" target="_blank">Facebook Group</a>
                    <a href="index.html">Home</a>
                    <a href="laws.html">Laws</a>
                    <a href="routes.html">Routes</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 New England E-Bike and PEV Community. Ride safe! âš¡</p>
            </div>
        </div>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css">
    <script>
        // Initialize the map centered on New England
        const map = L.map('trail-map').setView([43.0, -71.5], 7);
        
        // Add tile layer (using OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors | Charging data: NREL AFDC'
        }).addTo(map);
        
        // Layer groups
        const trailsLayer = L.layerGroup().addTo(map);
        const chargingLayer = L.markerClusterGroup({
            maxClusterRadius: 50,
            spiderfyOnMaxZoom: true,
            showCoverageOnHover: false,
            zoomToBoundsOnClick: true,
            disableClusteringAtZoom: 14
        });
        
        // Custom icons by state for trails
        function createTrailIcon(color) {
            return L.divIcon({
                className: 'custom-marker',
                html: `<div style="background:${color};width:24px;height:24px;border-radius:50%;border:3px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;font-size:12px;">ğŸš´</div>`,
                iconSize: [24, 24],
                iconAnchor: [12, 12],
                popupAnchor: [0, -12]
            });
        }
        
        // Charging station icons
        function createChargingIcon(type) {
            const colors = {
                'J1772': '#f59e0b',
                'NEMA': '#10b981',
                'Other': '#6b7280'
            };
            const color = colors[type] || colors['Other'];
            return L.divIcon({
                className: 'charging-marker',
                html: `<div style="background:${color};width:20px;height:20px;border-radius:50%;border:2px solid white;box-shadow:0 2px 4px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;font-size:10px;">âš¡</div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10],
                popupAnchor: [0, -10]
            });
        }
        
        const trailIcons = {
            VT: createTrailIcon('#2ecc71'),
            NH: createTrailIcon('#9b59b6'),
            ME: createTrailIcon('#e74c3c'),
            MA: createTrailIcon('#3498db'),
            CT: createTrailIcon('#f39c12'),
            RI: createTrailIcon('#1abc9c')
        };
        
        // Extended trail data with navigation and website info
        const trails = [
            { name: "Island Line Trail", state: "VT", lat: 44.4759, lng: -73.2121, distance: "14 miles", desc: "Lake Champlain views, causeway over water", topPick: true, trailheadLat: 44.4801, trailheadLng: -73.2210, website: "https://localmotion.org/island-line-trail/" },
            { name: "Montpelier & Wells River Rail Trail", state: "VT", lat: 44.2628, lng: -72.2339, distance: "19 miles", desc: "Forest scenery, Lake Groton swimming", trailheadLat: 44.3252, trailheadLng: -72.2234, website: "https://fpr.vermont.gov/montpelier-and-wells-river-rail-trail" },
            { name: "Northern Rail Trail", state: "NH", lat: 43.4326, lng: -71.8657, distance: "59.3 miles", desc: "Longest in NH, Top 100 US Trail", topPick: true, trailheadLat: 43.6424, trailheadLng: -72.2526, website: "https://www.northernrailtrail.org/" },
            { name: "Presidential Rail Trail", state: "NH", lat: 44.3876, lng: -71.1851, distance: "18 miles", desc: "White Mountains views, beaver ponds", trailheadLat: 44.3902, trailheadLng: -71.1925, website: "https://www.nhstateparks.org/visit/recreational-rail-trails/presidential-recreational-rail-trail" },
            { name: "Cotton Valley Trail", state: "NH", lat: 43.6106, lng: -71.2437, distance: "12 miles", desc: "Lakes Region, 5-star rated", trailheadLat: 43.6054, trailheadLng: -71.2139, website: "https://www.nhstateparks.org/visit/recreational-rail-trails/cotton-valley-rail-trail" },
            { name: "Eastern Trail", state: "ME", lat: 43.5510, lng: -70.3559, distance: "22 miles", desc: "Wildlife refuge, blueberry barrens", topPick: true, trailheadLat: 43.6501, trailheadLng: -70.2457, website: "https://www.easterntrail.org/" },
            { name: "Kennebec River Rail Trail", state: "ME", lat: 44.3106, lng: -69.7795, distance: "6.5 miles", desc: "Paved riverside, beginner friendly", trailheadLat: 44.3135, trailheadLng: -69.7746, website: "https://www.krrt.org/" },
            { name: "Eastern Promenade Trail", state: "ME", lat: 43.6680, lng: -70.2420, distance: "2+ miles", desc: "Portland, ocean views", trailheadLat: 43.6680, trailheadLng: -70.2420, website: "https://trails.org/our-trails/eastern-promenade-trail/" },
            { name: "Cape Cod Rail Trail", state: "MA", lat: 41.7563, lng: -70.0611, distance: "22 miles", desc: "Beach access, pet friendly", topPick: true, trailheadLat: 41.6777, trailheadLng: -70.1562, website: "https://www.mass.gov/locations/cape-cod-rail-trail" },
            { name: "Shining Sea Bikeway", state: "MA", lat: 41.5516, lng: -70.6162, distance: "11 miles", desc: "Coastal Falmouth, Buzzards Bay", trailheadLat: 41.5853, trailheadLng: -70.5489, website: "https://www.mass.gov/locations/shining-sea-bikeway" },
            { name: "Ashuwillticook Rail Trail", state: "MA", lat: 42.5551, lng: -73.1568, distance: "12.7 miles", desc: "Berkshires, Mount Greylock views", trailheadLat: 42.6230, trailheadLng: -73.1167, website: "https://www.mass.gov/locations/ashuwillticook-rail-trail" },
            { name: "Nashua River Rail Trail", state: "MA", lat: 42.5612, lng: -71.5836, distance: "12.5 miles", desc: "Cross-state to NH", trailheadLat: 42.5562, trailheadLng: -71.5856, website: "https://www.mass.gov/locations/nashua-river-rail-trail" },
            { name: "Air Line State Park Trail", state: "CT", lat: 41.7004, lng: -72.2273, distance: "50 miles", desc: "Historic Ghost Train route, viaducts", topPick: true, trailheadLat: 41.5715, trailheadLng: -72.5098, website: "https://portal.ct.gov/DEEP/State-Parks/Parks/Air-Line-State-Park-Trail" },
            { name: "Farmington Canal Heritage Trail", state: "CT", lat: 41.4925, lng: -72.8990, distance: "80+ miles", desc: "Historic canal route", trailheadLat: 41.3082, trailheadLng: -72.9268, website: "https://www.farmingtoncanal.org/" },
            { name: "East Bay Bike Path", state: "RI", lat: 41.7060, lng: -71.3489, distance: "14.5 miles", desc: "Narragansett Bay views", topPick: true, trailheadLat: 41.8159, trailheadLng: -71.3897, website: "https://riparks.ri.gov/locations/east-bay-bike-path" },
            { name: "Blackstone River Bikeway", state: "RI", lat: 41.8604, lng: -71.4128, distance: "18+ miles", desc: "Historic industrial heritage", trailheadLat: 41.8604, trailheadLng: -71.4128, website: "https://www.blackstoneheritagecorridor.org/explore/bikeway/" }
        ];
        
        // Create trail popup with navigation buttons
        function createTrailPopup(trail) {
            const navUrl = `https://www.google.com/maps/dir/?api=1&destination=${trail.trailheadLat},${trail.trailheadLng}`;
            
            let buttons = `<div class="popup-buttons">
                <a href="${navUrl}" target="_blank" class="popup-btn popup-btn-nav">ğŸ“ Navigate</a>`;
            
            if (trail.website) {
                buttons += `<a href="${trail.website}" target="_blank" class="popup-btn popup-btn-web">ğŸŒ Website</a>`;
            }
            
            buttons += `</div>`;
            
            return `
                <h3>${trail.topPick ? 'â­ ' : ''}${trail.name}</h3>
                <p class="popup-distance">ğŸ“ ${trail.distance}</p>
                <p>${trail.desc}</p>
                ${buttons}
            `;
        }
        
        // Add trail markers
        trails.forEach(trail => {
            const marker = L.marker([trail.lat, trail.lng], { icon: trailIcons[trail.state] })
                .bindPopup(createTrailPopup(trail));
            trailsLayer.addLayer(marker);
        });
        
        // Charging stations data and loading
        let chargingData = [];
        let chargingLoaded = false;
        
        async function loadChargingStations() {
            if (chargingLoaded) return;
            
            document.getElementById('map-loading').style.display = 'flex';
            
            try {
                const response = await fetch('data/charging_stations.json');
                const data = await response.json();
                chargingData = data.stations;
                
                document.getElementById('charging-count').textContent = chargingData.length.toLocaleString();
                
                // Add markers to cluster group
                chargingData.forEach(station => {
                    if (!station.lat || !station.lng) return;
                    
                    const popup = createChargingPopup(station);
                    const marker = L.marker([station.lat, station.lng], { 
                        icon: createChargingIcon(station.chargerType) 
                    }).bindPopup(popup);
                    
                    marker.stationType = station.chargerType;
                    chargingLayer.addLayer(marker);
                });
                
                chargingLoaded = true;
                console.log(`Loaded ${chargingData.length} charging stations`);
                
            } catch (error) {
                console.error('Error loading charging stations:', error);
                document.getElementById('charging-count').textContent = 'Error';
            }
            
            document.getElementById('map-loading').style.display = 'none';
        }
        
        // Create charging station popup
        function createChargingPopup(station) {
            const navUrl = `https://www.google.com/maps/dir/?api=1&destination=${station.lat},${station.lng}`;
            const typeClass = station.chargerType.toLowerCase();
            
            let connectorList = '';
            if (station.connectors && station.connectors.length) {
                connectorList = station.connectors.slice(0, 3).join(', ');
                if (station.connectors.length > 3) connectorList += '...';
            }
            
            return `
                <div class="charging-popup">
                    <h3>âš¡ ${station.name}</h3>
                    <span class="charging-type ${typeClass}">${station.chargerType}</span>
                    <p class="charging-info">ğŸ“ ${station.address}, ${station.city}</p>
                    ${station.hours ? `<p class="charging-info">ğŸ• ${station.hours.substring(0, 50)}${station.hours.length > 50 ? '...' : ''}</p>` : ''}
                    ${station.pricing ? `<p class="charging-info">ğŸ’° ${station.pricing}</p>` : ''}
                    ${connectorList ? `<p class="charging-info">ğŸ”Œ ${connectorList}</p>` : ''}
                    <div class="popup-buttons">
                        <a href="${navUrl}" target="_blank" class="popup-btn popup-btn-nav">ğŸ“ Navigate</a>
                    </div>
                </div>
            `;
        }
        
        // Toggle handlers
        document.getElementById('toggle-trails').addEventListener('change', function() {
            if (this.checked) {
                map.addLayer(trailsLayer);
                this.parentElement.classList.add('active');
            } else {
                map.removeLayer(trailsLayer);
                this.parentElement.classList.remove('active');
            }
        });
        
        document.getElementById('toggle-charging').addEventListener('change', async function() {
            if (this.checked) {
                if (!chargingLoaded) {
                    await loadChargingStations();
                }
                map.addLayer(chargingLayer);
                this.parentElement.classList.add('active');
                // Show filter toggles
                document.getElementById('j1772-toggle').style.display = 'flex';
                document.getElementById('nema-toggle').style.display = 'flex';
            } else {
                map.removeLayer(chargingLayer);
                this.parentElement.classList.remove('active');
                // Hide filter toggles
                document.getElementById('j1772-toggle').style.display = 'none';
                document.getElementById('nema-toggle').style.display = 'none';
            }
        });
        
        // Mobile nav toggle
        const navToggle = document.querySelector('.nav-toggle');
        const navLinks = document.querySelector('.nav-links');
        
        navToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            navToggle.classList.toggle('active');
        });
    </script>
</body>
</html>
